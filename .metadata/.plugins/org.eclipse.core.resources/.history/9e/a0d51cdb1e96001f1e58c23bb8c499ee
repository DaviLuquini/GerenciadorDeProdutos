package GestaoDeProdutos.Infraestrutura;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import GestaoDeProdutos.Entidades.Bermuda;
import GestaoDeProdutos.Entidades.Camisa;
import GestaoDeProdutos.Entidades.Produto;

public class ProdutoRepositorio implements IProdutoRepositorio {
	private final DbConnection dbConnection;

	public ProdutoRepositorio() {
		dbConnection = new DbConnection();
	}

	// Adiciona um produto ao estoque
	@Override
	// Método para adicionar um produto ao banco de dados
	public void adicionarCamisa(Camisa camisa) {
		String sql = "INSERT INTO camisa (codigo, nome, quantidade, preco, manga, tamanho) VALUES (?, ?, ?, ?, ?, ?)";
		try (Connection connection = dbConnection.getConnection();
				PreparedStatement statement = connection.prepareStatement(sql)) {

			statement.setInt(1, camisa.getCodigo());
			statement.setString(2, camisa.getNome());
			statement.setInt(3, camisa.getQuantidade());
			statement.setDouble(4, camisa.getPreco());
			statement.setString(5, camisa.getManga());
			statement.setString(6, camisa.getTamanho());
			statement.executeUpdate();

			System.out.println("Produto adicionado com sucesso.");
		} catch (SQLException e) {
			System.err.println("Erro ao adicionar produto: " + e.getMessage());
		}
	}

	@Override
	// Método para adicionar um produto ao banco de dados
	public void adicionarBermuda(Bermuda bermuda) {
		String sql = "INSERT INTO bermuda (codigo, nome, quantidade, preco, cor, tamanho) VALUES (?, ?, ?, ?, ?, ?)";
		try (Connection connection = dbConnection.getConnection();
				PreparedStatement statement = connection.prepareStatement(sql)) {

			statement.setString(2, bermuda.getNome());
			statement.setInt(3, bermuda.getQuantidade());
			statement.setDouble(4, bermuda.getPreco());
			statement.setString(5, bermuda.getCor());
			statement.setInt(6, bermuda.getTamanho());
			statement.executeUpdate();

			System.out.println("Produto adicionado com sucesso.");
		} catch (SQLException e) {
			System.err.println("Erro ao adicionar produto: " + e.getMessage());
		}
	}

	// Atualiza a quantidade de um produto em estoque
	@Override
	public void atualizarQuantidade(Produto produto) {
	    Produto produtoExistente = buscarProduto(produto.getCodigo());
	    
	    if (produtoExistente != null) {
	        // Defina a tabela com base no tipo de produto
	        String tabela = produtoExistente.getNome().equals("Camisa") ? "camisa" : "bermuda";
	        String sql = "UPDATE " + tabela + " SET quantidade = ? WHERE codigo = ?";
	        
	        try (Connection connection = dbConnection.getConnection();
	             PreparedStatement statement = connection.prepareStatement(sql)) {
	            
	            statement.setInt(1, produto.getQuantidade());
	            statement.setInt(2, produto.getCodigo());
	            statement.executeUpdate();
	            
	            System.out.println("Quantidade atualizada com sucesso.");
	        } catch (SQLException e) {
	            System.err.println("Erro ao atualizar quantidade: " + e.getMessage());
	        }
	    } else {
	        System.err.println("Produto não encontrado.");
	    }
	}


	// Remove um produto do estoque
	@Override
	public void removerProduto(int codigo) {
		Produto produtoExistente = buscarProduto(codigo);
		if (produto != null) {
			  String tabela = produtoExistente.getNome().equals("Camisa") ? "camisa" : "bermuda";
		      String sql = "UPDATE " + tabela + " SET quantidade = ? WHERE codigo = ?";
		        
			try (Connection connection = dbConnection.getConnection();
					PreparedStatement statement = connection.prepareStatement(sql)) {
				
				statement.setInt(1, produto.getQuantidade());
				statement.setInt(2, produto.getCodigo());
				
				System.out.println("Quantidade atualizada com sucesso.");
			} catch (SQLException e) {
				System.err.println("Erro ao atualizar quantidade: " + e.getMessage());
			}
		}
	}

	// Lista todos os produtos no estoque
	@Override
	public List<Produto> listarProdutos() {
		if (produtos.isEmpty()) {
			System.out.println("Nenhum produto no estoque.");
		}
		return produtos;
	}

	// Busca um produto pelo código no estoque
	@Override
	public Produto buscarProduto(int codigo) {
		for (Produto produto : produtos) {
			if (produto.getCodigo() == codigo) {
				return produto;
			}
		}
		return null;
	}
}
